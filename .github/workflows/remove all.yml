name: Cleanup All Workflow Runs

on:
  workflow_dispatch:

jobs:
  delete-runs:
    runs-on: ubuntu-latest
    permissions:
      actions: write
    env:
      GH_TOKEN: ${{ secrets.GH_PAT }}
    steps:
      - name: Delete all workflow runs
        shell: bash
        run: |
          echo "ğŸš€ Menghapus semua histori run di repo ini..."
          
          # Ambil semua ID run kecuali yang sedang berjalan (current run)
          run_ids=$(gh run list --limit 500 --jq ".[] | select(.id != ${{ github.run_id }}) | .id")
          
          if [ -z "$run_ids" ]; then
            echo "âœ… Tidak ada histori run yang bisa dihapus."
          else
            for id in $run_ids; do
              gh run delete $id
              echo "ğŸ—‘ï¸ Run ID $id berhasil dihapus."
            done
            echo "ğŸ”¥ Semua bekas run lama telah dibersihkan!"
          fi
